<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pointage Cuisine</title>

  <!-- Design pr√™t √† l'emploi -->
  <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css">

  <style>
    :root { --w: 980px; }
    body { min-height: 100vh; background: linear-gradient(180deg,#0b1220,#0f172a); }
    header, main { max-width: var(--w); margin: 0 auto; }
    header { padding: 24px 16px 0; }
    main { padding: 8px 16px 40px; }
    .card { background: #0d1324; border: 1px solid #1f2a44; border-radius: 14px; padding: 18px; }
    h1, h2 { margin: .2rem 0 .8rem; }
    small.muted { color: #94a3b8; }
    table thead th { white-space: nowrap; }
    .actions { display: flex; gap: .5rem; flex-wrap: wrap; }
    footer { max-width: var(--w); margin: 24px auto 56px; padding: 0 16px; color:#94a3b8; }
  </style>
</head>

<body>
  <header>
    <h1>üçΩÔ∏è Pointage Cuisine</h1>
    <small class="muted">D√©clare ton pointage et garde l‚Äôhistorique dans ce navigateur.</small>
  </header>

  <main>
    <section class="card">
      <h2>D√©clarer mon pointage</h2>
      <form id="formPointage">
        <div class="grid">
          <div>
            <label for="nom">Nom / code</label>
            <input id="nom" name="nom" type="text" placeholder="Ex : Ennio" required>
          </div>

          <div>
            <label for="poste">Poste</label>
            <select id="poste" name="poste" required>
              <option value="">‚Äî S√©lectionnez ‚Äî</option>
              <option>Plonge</option>
              <option>Entr√©es</option>
              <option>Chauds</option>
              <option>Desserts</option>
              <option>Service</option>
              <option>√âconomat</option>
              <option>Pass</option>
            </select>
          </div>

          <div>
            <label for="depart">Heure de d√©part</label>
            <input id="depart" name="depart" type="time" placeholder="12:30" required>
          </div>

          <div>
            <label for="retard">Arriv√© en retard (min)</label>
            <input id="retard" name="retard" type="number" min="0" step="1" placeholder="Ex : 5">
          </div>

          <div>
            <label for="heuresSupp">Heures supp (si faites)</label>
            <input id="heuresSupp" name="heuresSupp" type="number" min="0" step=".25" placeholder="Ex : 1.5">
          </div>

          <div>
            <label for="commentaire">Commentaire (optionnel)</label>
            <input id="commentaire" name="commentaire" type="text" placeholder="Ex : Coup de feu + service banquet">
          </div>
        </div>

        <div style="margin-top:12px">
          <button type="submit">Envoyer</button>
        </div>
      </form>
    </section>

    <section class="card" style="margin-top:16px">
      <div class="grid">
        <div><h2>Historique (ce navigateur)</h2></div>
        <div class="actions" style="justify-content:flex-end; align-items:center">
          <button id="exportCsv" class="secondary">Exporter CSV</button>
          <button id="clearAll" class="contrast">Effacer</button>
        </div>
      </div>

      <div style="overflow:auto">
        <table id="tableau" role="grid">
          <thead>
            <tr>
              <th>Date</th>
              <th>Nom</th>
              <th>Poste</th>
              <th>D√©part</th>
              <th>Retard (min)</th>
              <th>Heures supp</th>
              <th>Commentaire</th>
              <th>Supp.</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <small class="muted">Astuce : pour un stockage partag√© par toute l‚Äô√©quipe, on pourra brancher plus tard un petit serveur.</small><br>
      <small class="muted">Fonctionne hors-ligne (stockage local du navigateur).</small>
    </section>
  </main>

  <footer>
    <small>¬©Ô∏è <span id="year"></span> Pointage Cuisine ‚Äî GitHub Pages</small>
  </footer>

  <script>
    // ------- Utilitaires -------
    const LS_KEY = "pointage_entries_v1";

    function loadEntries() {
      try {
        const raw = localStorage.getItem(LS_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch { return []; }
    }
    function saveEntries(list) {
      localStorage.setItem(LS_KEY, JSON.stringify(list));
    }
    function formatDate(d) {
      const dt = new Date(d);
      return dt.toLocaleString("fr-FR", { dateStyle: "short", timeStyle: "short" });
    }

    // ------- Rendu du tableau -------
    const tbody = document.querySelector("#tableau tbody");

    function render() {
      const data = loadEntries();
      tbody.innerHTML = "";
      if (!data.length) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 8;
        td.textContent = "Aucune entr√©e pour l‚Äôinstant.";
        tr.appendChild(td); tbody.appendChild(tr);
        return;
      }
      data.forEach((row, idx) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${formatDate(row.createdAt)}</td>
          <td>${row.nom || ""}</td>
          <td>${row.poste || ""}</td>
          <td>${row.depart || ""}</td>
          <td>${row.retard ?? ""}</td>
          <td>${row.heuresSupp ?? ""}</td>
          <td>${row.commentaire || ""}</td>
          <td><button class="secondary" data-del="${idx}" aria-label="Supprimer la ligne">üóëÔ∏è</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    // ------- Soumission du formulaire -------
    document.getElementById("formPointage").addEventListener("submit", (e) => {
      e.preventDefault();
      const f = e.target;
      const entry = {
        createdAt: Date.now(),
        nom: f.nom.value.trim(),
        poste: f.poste.value,
        depart: f.depart.value,
        retard: f.retard.value ? Number(f.retard.value) : "",
        heuresSupp: f.heuresSupp.value ? Number(f.heuresSupp.value) : "",
        commentaire: f.commentaire.value.trim()
      };
      if (!entry.nom || !entry.poste || !entry.depart) {
        alert("Nom, Poste et Heure de d√©part sont requis.");
        return;
      }
      const list = loadEntries();
      list.unshift(entry);
      saveEntries(list);
      f.reset();
      render();
    });

    // ------- Suppression par ligne -------
    tbody.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-del]");
      if (!btn) return;
      const index = Number(btn.getAttribute("data-del"));
      const list = loadEntries();
      list.splice(index, 1);
      saveEntries(list);
      render();
    });

    // ------- Export CSV -------
    document.getElementById("exportCsv").addEventListener("click", () => {
      const data = loadEntries();
      if (!data.length) { alert("Rien √† exporter."); return; }
      const header = ["Date","Nom","Poste","D√©part","Retard (min)","Heures supp","Commentaire"];
      const rows = data.map(r => [
        new Date(r.createdAt).toISOString(),
        r.nom ?? "", r.poste ?? "", r.depart ?? "",
        r.retard ?? "", r.heuresSupp ?? "", (r.commentaire ?? "").replace(/\n/g," ")
      ]);
      const csv = [header, ...rows].map(arr =>
        arr.map(v => `"${String(v).replace(/"/g,'""')}"`).join(";")
      ).join("\n");
      const blob = new Blob([csv], {type: "text/csv;charset=utf-8;"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "pointage.csv";
      document.body.appendChild(a); a.click();
      URL.revokeObjectURL(url); a.remove();
    });

    // ------- Effacer tout -------
    document.getElementById("clearAll").addEventListener("click", () => {
      if (confirm("Effacer tout l‚Äôhistorique de ce navigateur ?")) {
        localStorage.removeItem(LS_KEY);
        render();
      }
    });

    // ------- Init -------
    document.getElementById("year").textContent = new Date().getFullYear();
    render();
  </script>
</body>
</html>
